# Лабораторная работа №5


### Задание 1

- Задание: *Откалибровать собственную камеру при помощи доски aruco*

Калибровал не камеру ноутбука, а внешнюю веб-камеру. Код для калибровки был взят из файла calibrate_camera.cpp - примера, который идет вместе с ArUco, - и немного изменен. В результате получен файл с параметрами камеры - calibration.xml.

Часть фотографий для калибровки:

![Task1](https://user-images.githubusercontent.com/90468326/231988563-92dcd884-e73d-48e2-b2d4-484ad0efa75c.png)
![Task1_2](https://user-images.githubusercontent.com/90468326/231988604-620e1d95-7fe6-4802-830c-fea08b56045e.png)
![Task1_3](https://user-images.githubusercontent.com/90468326/231988690-ea2581ce-7e4a-4e3d-b498-a22078ca05e3.png)

Результаты:

![Task1_4](https://user-images.githubusercontent.com/90468326/231988917-952b3891-3298-4196-8c3a-c44e8aad8e0a.png)


### Задание 2

- Задание: *Откалибровать с помощью Calibration Toolbox (Matlab)*

В Matlab калибровка производилась при помощи шахматной доски, результат представлен на рисунке ниже. Как видно из двух файлов с результатами ошибка репроекции при калибровке с помощью Calibration Toolbox ниже, но стоит учитывать, что калибровка проводилась на большей выборке фотографии, не напрямую из видеопотока, что исключает дрожание камеры и/или доски при калибровке, при лучшем освещении и на зафиксированной поверхности, поэтому средняя ошибка репроекции составила 0,15 пикселей.

Пример работы и результат калибровки с указанием средней ошибки репроекции:
![Task2](https://user-images.githubusercontent.com/90468326/231988949-94702822-aaa5-4ce1-931f-0e62ade2370a.png)

![Task2_2](https://user-images.githubusercontent.com/90468326/231988984-e3440f0b-c2dd-4359-b982-2122d4c03085.png)
![Task2_3](https://user-images.githubusercontent.com/90468326/231988998-b9beab87-ca14-458f-8bb3-ca7261f127ca.png)




### Задание 3

- Задание: *Сгенерировать маркер Aruco из понравившегося словаря*

Генерация маркера осуществляется функцией createMarker, которая сохраняет его в файле "marker.png" (лежит в папке images).

![marker](https://user-images.githubusercontent.com/90468326/231989043-680b5161-b0df-41ea-a2c6-8d00ea59748b.png)



### Задание 4

- Задание: *Написать программу, которая бы детектировала маркер на изображении и рисовать куб с основанием в виде маркера (куб должен быть спроецирован на плоскость изображения и иметь различные цвета ребер). Используйте захват видеопотока с камеры (VideoCapture), чтобы получать изображения.*

Реализованы функции detectMarker и drawCubes. Сначала загружаются параметры камеры и данные из файла с параметрами детекции, затем детектируются маркеры, находятся координаты их углов, после чего при помощи функции estimatePoseSingleMarkers находятся матрицы преобразований из системы координат маркера к системе координат камеры. Затем задаются координаты вершин куба в системе координат маркера и при помощи функции projectPoints проецируются на изображение, полученное с камеры. Потом по найденным координатам точек на изображении рисуется куб с ребрами разного цвета.



https://user-images.githubusercontent.com/90468326/231989600-c7beabc5-63d0-4d8b-8d57-1757bf1b94d4.mp4

